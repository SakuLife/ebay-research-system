# システム構成の比較

## 🎯 結論：**GitHub Actions推奨**

| 項目 | GitHub Actions | Cloud Run | Cloud Functions |
|------|---------------|-----------|-----------------|
| **初期設定** | ⭐⭐⭐ 簡単 | ⭐⭐ やや複雑 | ⭐⭐ やや複雑 |
| **無料枠** | 月2,000分 | 180万リクエスト | 200万リクエスト |
| **タイムアウト** | **6時間** | 60分 | 9分 |
| **デプロイ** | git push のみ | CI/CD設定必要 | CI/CD設定必要 |
| **環境変数** | Secrets（簡単） | Secret Manager | Secret Manager |
| **ログ確認** | GitHub UI | Cloud Logging | Cloud Logging |
| **コスト** | ほぼ無料 | 無料枠超過で課金 | 無料枠超過で課金 |
| **学習コスト** | 低い | 中 | 中 |
| **完結性** | **GitHub完結** | GCP必要 | GCP必要 |
| **同時実行** | 20並列 | 無制限 | 無制限 |

---

## ✅ GitHub Actionsのメリット

### 1. **超シンプル**
- GitHubだけで完結
- GCPアカウント不要
- デプロイ = git push

### 2. **ほぼ無料**
```
月100件処理 × 2分/件 = 200分
→ 無料枠2,000分内で収まる
```

### 3. **管理が楽**
- コードとインフラが同じリポジトリ
- Secretsで環境変数管理（GASと同じ感覚）
- ログがGitHub UIで見やすい

### 4. **非エンジニアでも運用可能**
- git push だけで最新版に更新
- GAS側は変更不要
- エラーログがWebで見れる

---

## ❌ デメリット

### 1. **同時実行制限**
- 無料プランは同時20ジョブまで
- → 実際は問題なし（1件2分程度）

### 2. **レスポンスが若干遅い**
- 起動に10〜20秒かかる
- → Cloud Runなら3秒程度
- → 実用上問題なし

---

## 🏗️ 推奨構成

```
┌─────────────────────────────────────┐
│   Googleスプレッドシート            │
│   - 入力シート（B列にeBay URL）    │
│   - カスタムメニュー               │
└──────────┬──────────────────────────┘
           │
           │ ボタンクリック
           ↓
┌──────────────────────────────────────┐
│   Google Apps Script (GAS)           │
│   - GitHub API呼び出し               │
│   - repository_dispatch トリガー     │
└──────────┬───────────────────────────┘
           │
           │ GitHub API
           ↓
┌──────────────────────────────────────┐
│   GitHub Actions (Python)            │
│   ┌──────────────────────────────┐   │
│   │ 1. eBay API                  │   │
│   │    - アイテム情報取得         │   │
│   └──────────────────────────────┘   │
│   ┌──────────────────────────────┐   │
│   │ 2. Gemini API                │   │
│   │    - 英→日翻訳               │   │
│   └──────────────────────────────┘   │
│   ┌──────────────────────────────┐   │
│   │ 3. 国内ソーシング            │   │
│   │    - 楽天API                 │   │
│   │    - Amazon PA-API           │   │
│   └──────────────────────────────┘   │
│   ┌──────────────────────────────┐   │
│   │ 4. 利益計算                  │   │
│   └──────────────────────────────┘   │
│   ┌──────────────────────────────┐   │
│   │ 5. スプレッドシート書き込み   │   │
│   │    - gspread                 │   │
│   └──────────────────────────────┘   │
└──────────┬───────────────────────────┘
           │
           │ API経由
           ↓
┌──────────────────────────────────────┐
│   Googleスプレッドシート             │
│   - 結果が自動反映                   │
│   - ステータス「要確認」             │
└──────────────────────────────────────┘
```

---

## 📦 ファイル構成

```
ebaySystem/
├── .github/
│   └── workflows/
│       └── research.yml          # GitHub Actions定義
├── src/
│   ├── ebay_client.py           # eBay API
│   ├── sourcing.py              # 楽天/Amazon
│   ├── profit.py                # 利益計算
│   ├── sheets_client.py         # スプレッドシート
│   ├── spreadsheet_mapping.py   # カラムマッピング
│   └── github_actions_runner.py # メイン処理
├── config/
│   ├── fee_rules.yaml
│   ├── categories.yaml
│   └── hotwords.yaml
├── docs/
│   ├── SETUP_GITHUB_ACTIONS.md
│   └── 構成比較.md
├── requirements.txt
└── README.md
```

---

## 🎬 セットアップ所要時間

| 作業 | 時間 |
|------|------|
| GitHubリポジトリ作成 | 5分 |
| Secrets設定 | 10分 |
| Personal Access Token作成 | 3分 |
| GAS設定 | 10分 |
| 動作確認 | 5分 |
| **合計** | **30分** |

---

## 💡 運用イメージ

### 日常作業（非エンジニア）
1. スプレッドシートにeBay URL貼り付け
2. メニュー「この行をリサーチ」クリック
3. 1〜2分待つ
4. 結果確認
5. 必要に応じて手動調整

### コード更新（エンジニア）
```bash
# 機能追加・修正
vim src/sourcing.py

# コミット
git add .
git commit -m "Add new feature"

# デプロイ（これだけ）
git push
```

### トラブル時
1. GitHub → Actions タブでログ確認
2. エラー内容を確認
3. 必要に応じてコード修正
4. git push で即反映

---

## 🚀 今後の拡張

### フェーズ1（現在）
- [x] eBay URL → 国内ソーシング
- [x] 利益計算
- [x] スプレッドシート書き込み

### フェーズ2（将来）
- [ ] 一括処理（複数行を一度に）
- [ ] Discord/Slack通知
- [ ] 定期実行（毎日自動リサーチ）

### フェーズ3（将来）
- [ ] 英語タイトル生成
- [ ] 自動出品機能

---

## ✨ まとめ

**GitHub Actions**は：
- ✅ セットアップが簡単
- ✅ 運用コストが低い（ほぼ無料）
- ✅ デプロイが楽（git push のみ）
- ✅ 非エンジニアでも使える
- ✅ スケールしやすい

**Cloud Run/Functions**は：
- レスポンスが若干速い
- 同時実行制限なし
- ただし設定が複雑＆コスト高

→ **このプロジェクトにはGitHub Actionsが最適**
